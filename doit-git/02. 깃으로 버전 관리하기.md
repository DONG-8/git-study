# 2. 깃으로 버전 관리하기



## 02-1 깃 저장소 만들기



### 깃 초기화 하기

> 깃 초기화를 하면 이때부터 해당 디렉터리에 있는 파일들을 버전관리할 수 있습니다.

```bash
$ git init
```

"Initialized empth Git repository in ~~~"

이라는 메세지가 뜨면 이때부터 해당 디렉터리에서 깃을 사용할 수 있습니다.

---

##### .git 디렉터리는 감춰져 있습니다. 

윈도우의 탐색기나 맥 Finder 에서 hello-git 디렉터리를 열었을 때 .git 디렉터리가 화면에 나타나지 않을 수 있습니다. 사용자가 실수로 디렉터리를 지우지 않도록 숨어있기 때문입니다. 윈도우 탐색기에서는 [보기] 탭 에서 '숨긴 항목'을 체크하고, 맥이라면 `shift`+ `comment` + `.` 을 이용하여 숨은 파일을 확인해 보세요.

---



## 02-2 버전 만들기



#### 버전이란?

> 프로그램 개발에서는 수정 내용이 쌓이면 새로 번호를 붙여서 이전 상태와 구별합니다.
>
> 번호등을 통해 구별된 것을 버전이라고 부릅니다.



### 깃에서 버전이란?

깃에서 버전이란 문서를 수정하고 저장할 때마다 생기는 것!

깃에서 버전관리를 하면 원래 파일 이름은 그대로 유지하면서 파일에서 무엇을 변경햇는지를 변경시점마다 저장할 수 있습니다.

각 버전마다 작업했던 내용을 확인할 수 있고, 그 버전으로 되돌아갈 수 도 있습니다.



### 스테이지와 커밋 이해하기

#### 작업트리

​	파일의 수정, 저장 등의 작업을 하는 디렉터리, 즉 우리의 작업공간이다.



#### 스테이지

​	버전으로 만들 파일이 대기하는곳, 배우들의 대기실과 같은 공간이라고 보면 된다.

​	우리가 수정하거나 업로드하고싶은 파일들이 대기 하는장소



#### 저장소

​	스테이지에서 대기하고 있던 파일들을 버전으로 만들어 저장하는 곳,  '리포지토리' 혹은 '저장소' 라는 용어로 불린다.

​	스테이지와 저장소는 눈에 보이지 않습니다. .git 안에 숨은 파링 형태로 존재하는 영역입니다.



​	commit 명령어를 통해 스테이지 대기한 데이터들이 저장소로 이동된다.

> 정리!
>
> 문서수정 -> 스테이지 저장 -> 저장소로 커밋!
>
> 위 과정이 깃이 버전을 만드는 순서이다!



### 깃 상태 확인 status

```bash
$ git status
```

#### 깃 상태 메세지

1. On branch master : 현재 master 브랜치에 있습니다. 
2. No commits yet : 아직 커밋한 파일이 없습니다.
3. nothing to commit : 현재 커밋할 파일이 없습니다.
4. untracked files : 아직 한번도 버전관리하지 않은 파일을 명시



### 수정한 파일을 스테이징하기 -git add

> 파일을 만들거나 수정했다면 스테이지에 수정한 파일을 추가합니다.
>
> 이렇게 깃에세 버전만들 준비를 하라고 알려주는것을 '스테이징' 또는 '스테이지에 올린다' 라고 표현합니다.



```bash
$ git add '파일명'
```

이후

```bash
$ git status
```

를 통해 상태를 확인하면

untracked files: --> changes to be committed: 로 변경됨

새로 추가 된 파일에는

new file: '파일명' 으로 나타난다.



### 스테이지에 올라온 파일 커밋하기 -git commit

> 파일이 스테이지에 있다면 이제 버전을 만들 수 있습니다.
>
> 깃에서는 버전을 만드는 행위를 '커밋(commit)한다' 고 말합니다.
>
> 커밋에는 어떠한 변경사항이 있었는지 확인하기 위해 메시지를 함께 기록해 두어야 합니다.



####  커밋 명령어

```bash
$ git commit -m "message"
```

커밋 결과

변경사항에 대한 추가(+) 삭제(-) 상태를 알려줌



```bash
$ git status
```

를 통한 상태 확인

nothing to commit, working tree clean 이라는 메세지를 확인할 수 있다.



그렇다면 버전이 제대로 만들어졌는지 어떻게 확인할까요?

#### 버전 확인

```bash
$ git log
```

커밋한 버전에 대한 설명이 나옵니다.

1. 커밋을 만든 사람,
2. 만든 시간
3. 커밋 메세지

수정한 파일을 커밋하면 이렇게 수정과 관련된 여러 정보를 함께 저장할 수 있습니다.



### 스테이징과 커밋 한꺼번에 처리하기 -git commit -am

> 조건 : 한번 커밋한 파일이라면 위명령어를 사용 가능합니다.

```bash
$ git commit -am "message2"
```





## 02-3 커밋 내용 확인하기

버전을 관리하기 위해서는 지금까지 어떤 버전을 만들었는지 알 수 있어야 합니다. 또 각 버전마다 어떤 자이가 있는지도 파악할 수 있어야겠죠?



### 커밋 기록 자세히 살펴보기  - git log

> 커밋한 기록을 살펴보기 위한 명령어

```bash
$ git log
```

여러 상태창들을 볼 수 있다.

1.  commit hash || git hash : commit 항목 옆에 영문과 숫자로 된 긴 문자열
   - (HEAD -> master) : 최신 버전임을 나타낸다
2. Author : 누가 버전을 만들었는지에 대한 정보
3. Date : 버전 생성날짜

이들을 묶어 **커밋로그** 라고 부른다.



### 변경사항 확인하기 -git diff

> 어떤 변경사항들이 있는지 찾아야 할 때 유용함
>
> 이를 위한 전제조건 하나의 파일 변경사항이 생겼을 때, 커밋을 통해 변경사항들을 확인하여 충돌을 방지하면 좋겠다는 생각이 드네용



#### 2가지 확인가능

1. 작업트리 vs 스테이지파일 비교
2. 스테이지파일 vs 저장소 최신 커밋 비교

이를 통해 수정한 파일을 커밋하기 전에 최종적으로 검토할 수 있습니다.

```bash
$ git diff
```

 변경사항들을 확인할 수 있습니다.



## 02-4 버전 만드는 단계마다 파일 상태 알아보기

> 깃에서는 버전을 만드는 각 단계마다 파일 상태를 다르게 표시합니다. 
>
> 그래서 파일의 상태를 이해하면 이 파일이 버전 관리의 여러 단계 중 어디에 있는지, 그 상태에서 어떤 일을 할 수 있는지 알 수 있습니다.



### tracked 파일과 untracked 파일

`git status` 명령어를 통해 나타난 상태창에는 여러 메세지가 나타납니다.

작업 트리에 있는 파일을 크게 `tracked` 상태와 `untracked` 상태로 나뉩니다. 이 2가지에 대해서 알아보겠습니다.



2가지의 파일이 존재한다고 보겠습니다

1. 기존에 커밋을 했던 파일 -- > A
2. 새로 만들어진 파일 --> B



`git status`를 통해 상태 확인 시

A : 'Changes not staged for commit' 이라는 메세지와 함께 파일 명 앞에 `modified` 라는 메세지를 확인할 수 있습니다.

- modified : 수정 되었음을 알립니다.

이렇게 git은 한번 커밋 한 파일의 수정 여부를 계속 추적합니다. 

#### **tracked : git이 추적하고 있다는 뜻**



B : 'untracked files' 한번도 버전관리를 하지 않았기 때문에 untracked 파일이라고 표시됩니다.

 파일 명 앞에는 new file: '파일명' 과 함께 표시되어 있습니다.



이후 `git add .`을 통해 두가지 다 stage에 올려줍니다.

이전 status 상태를 통해 보았던 파일 상태와 함께 스테이지에 올라간 모습을 확인할 수 있습니다.

이후 `commit`

```bash
$ git commit -m "message3"
$ git log
```

`git log` 명령을 통해 확인 한 상태는

작성자, 날짜, 커밋 명 만 확인할 수 있습니다.

### 각 커밋에 관련된 파일을 확인하는 명령어

```bash
$ git log --stat
```

로그 메세지가 많을 경우 한 화면씩 나누어 보여줍니다.

1. `Enter` : 다음 로그 화면
2. `Q` : 로그 화면을 나와 다시 깃 명령을 입력할 수 있습니다.



상태창에서는 각 파일의 몇가지가 변경되었는지 각각 확인할 수 있습니다!



### unmodified, modified, staged 상태

> 한번이라도 버전을 만들었던 파일은 tracked 상태가 된다!
>
> tracked 상태파일의 경우 
>
> 1. 현재 작업 트리에 있는지
> 2. 스테이지에 있는지
> 3. ... 등
>
> 더 구체적인 상태를 알려줍니다.



Untracked : 한번도 커밋되지 않은 상태



1. 수정 전

### unmodefied  : 수정되지 않은 상태

```
nothing to commit, working tree clean
```



2. 수정 이후

### moidfied : 수정만 된 상태

```
changes not staged for commit
~~~~

		modified : hellow.txt
```



3. `git add`  이후

### staged : 커밋 직전 단계

```
changes to be committed:
```



4. commit 이후

### unmodified : 수정이 없는 상태

```
nothing to commit, working tree clean
```

스테이지에 올라간 이후이기때문에 다시 unmodified 상태로 돌아간다.



untracked 		unmodified 		modified		staged

최초커밋전

​						커밋 이후

​														수정된 상태커밋 x

​																				commit을 통한 스테이징

​																					이후 unmodified로 이동



### 방금 커밋한 메시지 수정하기

```bash
$ git commit --amend
```

원래 입력했던 메세지가 나타납니다

`l`을 눌러 입력모드로 바꾸면 메세지 수정이 가능합니다.

수정이 끝났다면 ex모드로 돌아가 내용을 저장하면서 빔을 종료하세요.

| :w or :write | 편집중이던 문서를 저장합니다.                                |
| ------------ | ------------------------------------------------------------ |
| :q or :quit  | 편집기 종료                                                  |
| :wq          | 편집중이던 문서를 저장하고 종료합니다. 파일 이름을 함께 입력하면 그 이름으로 저장합니다. |
| :q!          | 문서를 저장하지 않고 편집기를 종료합니다. 확장자가 .swp인 임시 파일이 생깁니다. |



## 02-5 작업 되돌리기 

> 파일을 수정하고 단계를 거쳤다면, 스테이지에 올릴 파일을 내리거나 커밋을 취소하는 등 각 단계로 돌아가는 방법에 대해 알아보겠습니다.



### 작업 트리에서 수정한 파일 되돌리기 -git checkout

> 파일을 수정한 뒤 소스가 정상적으로 동작하지 않는 등의 이유로 수정한 내용을 취소하고 가장 최신 버전상태로 되돌려야할 때 사용합니다.
>
> 직접보다 명령어 하나로 처리된다면 아주 좋겠죠?

##### :red_circle: 주의사항!!! :  checkout 으로 되돌린 내용은 다시 복구할 수 없습니다! 주의하세요!!



#### - 파일 수정을 취소하고 원래대로 되돌리기

1. 수정 직후의 `modfied ` 상태에서  `git status` 명령어 사용 시 가능하다.

   - ```bash
     $ git checkout
     ```

   - 결과는 ? : 수정 했던 내용이 원 상태로 돌아가 있음을 확인할 수 있다.

   - ```bash
     $ cat "파일명"
     ```

   -  파일 내용 확인 명령어



### 스테이징 되돌리기  -git reset HEAD 파일이름

#### - 수정된 파일을 스테이징 했을 때, 스테이징을 취소하는 방법

1. 수정 후 `add` 로 staged: 상태일 때

   - ```bash
     git reset HEAD 파일명
     ```

   - 이를 통해 내리기

   - ```
     결과 메세지
     Unstaged changes after reset:
     		unstaged된 파일
     ```

   - 이후 git status를 통한 상태 확인 결과

   - ```
     modefied 상태로 돌아가 있음
     message
     
     Changes not staged for commit
     ```



### 최신 커밋 되돌리기  - git reset HEAD^

#### - 수정된 파일을 스테이징 하고 커밋까지 했을 때, 가장 마지막에 한 커밋을 취소하는 방법

1. 커밋까지 마친 상태일 때 : unmodified 상태

   - ```bash
     $ git log
     ```

   - 를 이용한 상태 확인

   - ```bash
     $ git reset HEAD^
     ```

   - 커밋 취소 & 스테이징 해제

:record_button:참고 사항 : git reset 명령의 옵션 살펴보기

| 명령          | 설명                                                         |
| ------------- | ------------------------------------------------------------ |
| --soft HEAD^  | 최근 커밋을 하기 전 상태로 작업  트리를 되돌립니다.          |
| --mixed HEAD^ | 최근 커밋과 스테이징을 하기 전 상태로 작업 트리를 되돌립니다. <br />옵션 없이 git reset 명령을 사용할 경우 이 옵션을 기본으로 작동합니다 |
| --hard HEAD^  | 최근 커밋과 스테이징, 파일을 수정을 하기 전 상태로 작업트리를 되돌립니다. <br />이 옵션으로 되돌린 내용은 복구할 수 없습니다. |



###  특정 커밋으로 되돌리기 - git reset 커밋 해시

> 특정 버전으로 돌린 후 그 이후버전을 삭제할 수도 있습니다.

:red_circle: 주의사항 

reset해서 커밋 해시를 사용해 되돌릴 때 주의할 점이 있습니다. reset A 를 입력한다면 이 명령은 A 커밋을 리셋하는것이 아니라 A 커밋 이후에 만들었던 커밋을 삭제하고 A 커밋으로 이동하겠다는 의미입니다.



1. commit  이후에 적혀있는 영문과 숫자들을 복사해줍니다.

2. ```bash
   $ git reset --hard 복사한 커밋 해시
   ```

3. ```
   출력 message : HEAD is now at ~~~
   ```

4. 복사한 커밋 해시가 가장 최신 커밋이 되었다.

5. ```bash
   $ git log
   ```

6. 를 통한 상태 확인 시 이후에 해주었던 커밋은 삭제되었다.

7. **또한 스테이징과 커밋을 했던 변경사항 역시 변경되어지기 전으로 돌아온다.** ==> why?? reset --hard 이기 때문에 파일역시 변경 전으로 돌아갑니다.



### 커밋 삭제하지 않고 되돌리기 --git revert

> 삭제해도 된다면 reset
>
> 하지만 !!!!!
>
> 나중에 사용할 것을 대비해서 커밋을 되돌리더라도 취소한 커밋을 남겨우어야 할 때가 있습니다.
>
> 이때는 git revert 라는 명령을 사용합니다.



###### 이때의 경우 우리가 취소하려고 하는 버전의 커밋해시를 지정해야 합니다



```bash
$ git revert 복사한 취소하려고하는 커밋해시
```

결과

`git log`를 통해 확인하면 취소하려고 하는 커밋이 사라지지 않고, Revert 라는 문구와 함께 새로 나타난 모습을 확인할 수 있다.

이때 취소를 했다면

**취소한 커밋에서의 변경사항 역시 변경되어지기 전으로 돌아갑니다.**

---

2장 종료



